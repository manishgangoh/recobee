<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Box Office Dashboard - Dark Theme</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" />
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <style>
        :root {
            --bg-dark: #121212;
            --bg-card: #1E1E1E;
            --text-white: #FFFFFF;
            --text-yellow: #FFD700;
            --accent-yellow: #FFD700;
            --accent-dark-yellow: #FFC000;
            --border-color: #333333;
            --chart-grid: #333333;
            --chart-text: #CCCCCC;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-white);
            padding: 20px;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .dashboard-title {
            font-size: 28px;
            font-weight: 600;
            color: var(--text-white);
        }
        
        .dashboard-update {
            color: var(--text-yellow);
            font-size: 14px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
        }
        
        .card {
            background-color: var(--bg-card);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-white);
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 6px 12px;
            border-radius: 4px;
            border: 1px solid var(--accent-yellow);
            background-color: transparent;
            color: var(--accent-yellow);
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background-color: var(--accent-yellow);
            color: var(--bg-dark);
        }
        
        .btn-primary {
            background-color: var(--accent-yellow);
            color: var(--bg-dark);
            border-color: var(--accent-yellow);
        }
        
        .btn-primary:hover {
            background-color: var(--accent-dark-yellow);
            border-color: var(--accent-dark-yellow);
        }
        
        .overview-panel {
            grid-column: span 4;
        }
        
        .total-box-office {
            font-size: 32px;
            font-weight: 600;
            margin: 15px 0;
            color: var(--accent-yellow);
        }
        
        .day-wise-collection {
            grid-column: span 8;
        }
        
        .chart-container {
            height: 250px;
            margin-top: 20px;
            position: relative;
        }
        
        .heatmap {
            grid-column: span 6;
        }
        
        .hourly-trend {
            grid-column: span 6;
        }
        
        .revenue-by-city {
            grid-column: span 4;
        }
        
        .occupancy {
            grid-column: span 4;
        }
        
        .top-cities {
            grid-column: span 4;
        }
        
        .theatre-data {
            grid-column: span 12;
        }
        
        .pricing-insights {
            grid-column: span 12;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-white);
        }
        
        th {
            background-color: rgba(255, 215, 0, 0.1);
            font-weight: 600;
            color: var(--accent-yellow);
        }
        
        tr:hover {
            background-color: rgba(255, 215, 0, 0.05);
        }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .filter-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex-grow: 1;
        }
        
        .filter-item label {
            font-size: 12px;
            color: var(--text-yellow);
        }
        
        select, input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-dark);
            color: var(--text-white);
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: var(--accent-yellow);
        }
        
        .progress-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .progress-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .progress-label {
            width: 100px;
            font-size: 14px;
            color: var(--text-white);
        }
        
        .progress-bar {
            flex-grow: 1;
            height: 20px;
            background-color: var(--border-color);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--accent-yellow);
        }
        
        .city-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .city-item:last-child {
            border-bottom: none;
        }
        
        .pricing-grid {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
            margin-top: 20px;
        }
        
        .pricing-card {
            background: none;
            border: none;
            box-shadow: none;
            padding: 0;
            text-align: center;
        }
        
        .circle-chart-container {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto 8px auto;
        }
        
        .circle-chart-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 22px;
            font-weight: 600;
            color: #222;
            pointer-events: none;
        }
        
        .circle-chart-value.economy { color: #FFD700; }
        .circle-chart-value.gold { color: #FFC000; }
        .circle-chart-value.vip { color: #FFA500; }
        
        .pricing-label {
            font-size: 15px;
            color: #222;
            margin-top: 4px;
        }
        
        .economy {
            color: var(--accent-yellow);
        }
        
        .gold {
            color: #FFC000;
        }
        
        .vip {
            color: #FFA500;
        }
        
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: repeat(6, 1fr);
            }
            
            .overview-panel, .revenue-by-city, .occupancy, .top-cities {
                grid-column: span 3;
            }
            
            .day-wise-collection, .heatmap, .hourly-trend {
                grid-column: span 6;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .overview-panel, .revenue-by-city, .occupancy, .top-cities,
            .day-wise-collection, .heatmap, .hourly-trend {
                grid-column: span 2;
            }
            
            .filters {
                flex-direction: column;
            }
        }
        .alerts-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 18px 0 0 0;
        }
        .alert-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 15px;
            background: #181818;
            color: var(--text-white);
            border-left: 4px solid var(--accent-yellow);
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
        }
        .alert-icon {
            font-size: 20px;
        }
        .alert-high { border-left-color: #00e676; }
        .alert-low { border-left-color: #FF6B6B; }
        .alert-cancel { border-left-color: #FF1744; }
        .alert-high .alert-icon { color: #00e676; }
        .alert-low .alert-icon { color: #FF6B6B; }
        .alert-cancel .alert-icon { color: #FF1744; }
        .city-link {
            color: var(--accent-yellow);
            cursor: pointer;
            text-decoration: underline;
        }
        .city-link:hover {
            color: var(--accent-dark-yellow);
        }
        .drilldown-modal {
            position: fixed;
            z-index: 9999;
            left: 0; top: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.7);
            display: flex; align-items: center; justify-content: center;
        }
        .drilldown-modal-content {
            background: #181818;
            color: var(--text-white);
            border-radius: 10px;
            padding: 32px 28px 24px 28px;
            min-width: 340px;
            max-width: 95vw;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            position: relative;
        }
        .drilldown-modal-close {
            position: absolute;
            top: 12px; right: 18px;
            font-size: 28px;
            color: var(--accent-yellow);
            cursor: pointer;
        }
        .drilldown-modal-content h2 {
            color: var(--text-white);
            font-size: 22px;
            margin-bottom: 18px;
        }
        .drilldown-modal-content table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 18px;
        }
        .drilldown-modal-content th, .drilldown-modal-content td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-white);
        }
        .drilldown-modal-content th {
            color: var(--accent-yellow);
            background: rgba(255,215,0,0.07);
        }
        .theatre-link {
            color: #00bcd4;
            cursor: pointer;
            text-decoration: underline;
        }
        .theatre-link:hover {
            color: #FFD700;
        }
        .show-link {
            color: #FFC000;
            cursor: pointer;
            text-decoration: underline;
        }
        .show-link:hover {
            color: #FFD700;
        }
        .seat-pie-container {
            width: 220px; margin: 0 auto 12px auto;
        }
        .section-title {
            color: var(--text-white);
            font-size: 2rem;
            font-weight: 700;
            margin: 40px 0 24px 0;
            letter-spacing: 0.5px;
        }
        .section-subtitle {
            color: var(--text-yellow);
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 18px;
        }
    </style>
    <style>
        table.dataTable {
            background: var(--bg-card);
            color: var(--text-white);
        }
        table.dataTable thead th {
            background: rgba(255,255,255,0.05);
            color: var(--text-white);
            border-bottom: 2px solid var(--accent-yellow);
        }
        table.dataTable tbody td {
            color: var(--text-white);
        }
        .dataTables_wrapper .dataTables_filter input {
            background: var(--bg-dark);
            color: var(--text-white);
            border: 1px solid var(--accent-yellow);
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button {
            background: var(--bg-dark);
            color: var(--accent-yellow) !important;
            border: 1px solid var(--accent-yellow);
            border-radius: 4px;
            margin: 0 2px;
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            background: var(--accent-yellow) !important;
            color: var(--bg-dark) !important;
        }
        .dt-button.btn.btn-primary {
            background: var(--accent-yellow);
            color: var(--bg-dark);
            border: 1px solid var(--accent-yellow);
            border-radius: 4px;
            margin-right: 8px;
            font-size: 12px;
        }
        .dt-button.btn.btn-primary:hover {
            background: var(--accent-dark-yellow);
            color: var(--bg-dark);
            border-color: var(--accent-dark-yellow);
        }
        .comparison-panel .filters {
            margin-bottom: 0;
        }
        .comparison-panel .filter-item label {
            color: var(--text-yellow);
        }
        .comparison-panel select {
            background: var(--bg-dark);
            color: var(--text-white);
            border: 1px solid var(--accent-yellow);
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Movie Box Office Dashboard</h1>
            <div class="dashboard-update">Updated 15 min ago</div>
        </div>
        
        <!-- 1. Overview Panel (Executive Summary) -->
        <div class="section-title">1. Overview Panel (Executive Summary)</div>
        <div class="dashboard-grid">
            <div class="card overview-panel">
                <div class="card-header">
                    <div class="card-title">Overview</div>
                </div>
                <div class="total-box-office">$73.6 Cr</div>
                <div style="color: var(--text-yellow);">Total Net Box Office</div>
                <div class="progress-container" style="margin-top: 30px;">
                    <div class="progress-item">
                        <div class="progress-label">Occupancy</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 40%;"></div>
                        </div>
                        <div>40%</div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">Drop-off</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 25%; background-color: #FF6B6B;"></div>
                        </div>
                        <div>25%</div>
                    </div>
                </div>
            </div>
            <div class="card day-wise-collection">
                <div class="card-header">
                    <div class="card-title">Day Wise Collection</div>
                    <div class="card-actions">
                        <button class="btn btn-primary">
                            <span>Export</span>
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="dayWiseChart"></canvas>
                </div>
            </div>
            <div class="card occupancy-trend">
                <div class="card-header">
                    <div class="card-title">Cumulative Occupancy Trend</div>
                </div>
                <div class="chart-container">
                    <canvas id="occupancyTrendChart"></canvas>
                </div>
            </div>
            <div class="card top-cities">
                <div class="card-header">
                    <div class="card-title">Top Cities in 3 Days</div>
                </div>
                <div>
                    <div class="city-item"><span class="city-link" data-city="Delhi">Delhi</span><span style="color: var(--accent-yellow);">59%</span></div>
                    <div class="city-item"><span class="city-link" data-city="Mumbai">Mumbai</span><span style="color: var(--accent-yellow);">17%</span></div>
                    <div class="city-item"><span class="city-link" data-city="Hyderabad">Hyderabad</span><span style="color: var(--accent-yellow);">19%</span></div>
                    <div class="city-item"><span class="city-link" data-city="Chennai">Chennai</span><span style="color: var(--accent-yellow);">12%</span></div>
                    <div class="city-item"><span class="city-link" data-city="Kolkata">Kolkata</span><span style="color: var(--accent-yellow);">11%</span></div>
                </div>
            </div>
        </div>
        <!-- 2. Performance Heatmap (Geo View) -->
        <div class="section-title">2. Performance Heatmap (Geo View)</div>
        <div class="dashboard-grid">
            <div class="card india-map-card" style="grid-column: span 12;">
                <div class="card-header">
                    <div class="card-title">Performance Heatmap (India Map)</div>
                </div>
                <div id="indiaMap" style="height: 400px; width: 100%; border-radius: 8px; overflow: hidden;"></div>
            </div>
        </div>
        <!-- 3. Theatre-Level Table (Searchable & Sortable) -->
        <div class="section-title">3. Theatre-Level Table (Searchable & Sortable)</div>
        <div class="dashboard-grid">
            <div class="card theatre-data" style="grid-column: span 12;">
                <div class="card-header">
                    <div class="card-title">Theatre-Level Data</div>
                    <div class="card-actions">
                        <button class="btn btn-primary" id="exportExcelBtn">
                            <span>Export</span>
                        </button>
                    </div>
                </div>
                <div class="filters">
                    <div class="filter-item">
                        <label>Date</label>
                        <select>
                            <option>Last 7 days</option>
                            <option>Last 30 days</option>
                            <option>Custom range</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label>Format</label>
                        <select>
                            <option>All</option>
                            <option>2D</option>
                            <option>3D</option>
                            <option>IMAX</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label>Language</label>
                        <select>
                            <option>All</option>
                            <option>Hindi</option>
                            <option>English</option>
                            <option>Regional</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label>Pricing</label>
                        <select>
                            <option>All</option>
                            <option>Economy</option>
                            <option>Gold</option>
                            <option>VIP</option>
                        </select>
                    </div>
                </div>
                <div style="overflow-x:auto;">
                <table id="theatreTable" class="display" style="width:100%">
                    <thead>
                        <tr>
                            <th>Theatre Name</th>
                            <th>City</th>
                            <th>Chain</th>
                            <th>Show Time</th>
                            <th>Occupancy %</th>
                            <th>Net Collection</th>
                            <th>Total Seats</th>
                            <th>Format</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Srex Cironas Prasads</td>
                            <td>Hyderabad</td>
                            <td>Prasads</td>
                            <td>6 PM</td>
                            <td>78%</td>
                            <td style="color: var(--accent-yellow);">12.5 Cr</td>
                            <td>320</td>
                            <td>IMAX</td>
                        </tr>
                        <tr>
                            <td>Prasads Inerbit</td>
                            <td>Hyderabad</td>
                            <td>Prasads</td>
                            <td>4 PM</td>
                            <td>65%</td>
                            <td style="color: var(--accent-yellow);">4.0 Cr</td>
                            <td>250</td>
                            <td>3D</td>
                        </tr>
                        <tr>
                            <td>Inerbit Mail Cinepolis</td>
                            <td>Hyderabad</td>
                            <td>Cinepolis</td>
                            <td>7 PM</td>
                            <td>55%</td>
                            <td style="color: var(--accent-yellow);">4.2 Cr</td>
                            <td>200</td>
                            <td>2D</td>
                        </tr>
                        <tr>
                            <td>Cinepolis Orten Mail</td>
                            <td>Delhi</td>
                            <td>Cinepolis</td>
                            <td>5:45 PM</td>
                            <td>60%</td>
                            <td style="color: var(--accent-yellow);">3.2 Cr</td>
                            <td>180</td>
                            <td>2D</td>
                        </tr>
                        <tr>
                            <td>Quixx Cinemas</td>
                            <td>Delhi</td>
                            <td>Quixx</td>
                            <td>4:28 PM</td>
                            <td>48%</td>
                            <td style="color: var(--accent-yellow);">3.0 Cr</td>
                            <td>150</td>
                            <td>2D</td>
                        </tr>
                    </tbody>
                </table>
                </div>
            </div>
        </div>
        <!-- 4. Time-Based Trends -->
        <div class="section-title">4. Time-Based Trends</div>
        <div class="dashboard-grid">
            <div class="card hourly-trend" style="grid-column: span 6;">
                <div class="card-header">
                    <div class="card-title">Hourly Trend</div>
                </div>
                <div class="chart-container">
                    <canvas id="hourlyTrendChart"></canvas>
                </div>
            </div>
            <div class="card showwise-breakdown" style="grid-column: span 6;">
                <div class="card-header">
                    <div class="card-title">Show-wise Revenue Breakdown</div>
                </div>
                <div class="chart-container">
                    <canvas id="showwiseBreakdownChart"></canvas>
                </div>
            </div>
            <div class="card audience-dropoff" style="grid-column: span 6;">
                <div class="card-header">
                    <div class="card-title">Audience Drop-off After First Show</div>
                </div>
                <div class="chart-container">
                    <canvas id="audienceDropoffChart"></canvas>
                </div>
            </div>
        </div>
        <!-- 5. City & Format Analysis -->
        <div class="section-title">5. City & Format Analysis</div>
        <div class="dashboard-grid">
            <div class="card revenue-by-city" style="grid-column: span 6;">
                <div class="card-header">
                    <div class="card-title">Revenue by City</div>
                </div>
                <div class="chart-container">
                    <canvas id="revenueByCityChart"></canvas>
                </div>
            </div>
            <div class="card occupancy-by-format" style="grid-column: span 6;">
                <div class="card-header">
                    <div class="card-title">Occupancy by Format</div>
                </div>
                <div class="chart-container">
                    <canvas id="occupancyByFormatChart"></canvas>
                </div>
            </div>
            <div class="card chain-performance" style="grid-column: span 6;">
                <div class="card-header">
                    <div class="card-title">Chain-level Performance</div>
                </div>
                <div class="chart-container">
                    <canvas id="chainPerformanceChart"></canvas>
                </div>
            </div>
            <div class="card pricing-insights" style="grid-column: span 6;">
                <div class="card-header">
                    <div class="card-title">Pricing Insights</div>
                </div>
                <div class="pricing-grid">
                    <div class="pricing-card">
                        <div class="circle-chart-container">
                            <canvas id="economyChart" width="80" height="80"></canvas>
                            <div class="circle-chart-value economy">68%</div>
                        </div>
                        <div class="pricing-label">Economy</div>
                    </div>
                    <div class="pricing-card">
                        <div class="circle-chart-container">
                            <canvas id="goldChart" width="80" height="80"></canvas>
                            <div class="circle-chart-value gold">36%</div>
                        </div>
                        <div class="pricing-label">Gold</div>
                    </div>
                    <div class="pricing-card">
                        <div class="circle-chart-container">
                            <canvas id="vipChart" width="80" height="80"></canvas>
                            <div class="circle-chart-value vip">60%</div>
                        </div>
                        <div class="pricing-label">VIP</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 6. Alerts & Anomalies -->
        <div class="section-title">6. Alerts & Anomalies</div>
        <div class="dashboard-grid">
            <div class="card alerts-anomalies" style="grid-column: span 6;">
                <div class="card-header">
                    <div class="card-title">Alerts & Anomalies</div>
                </div>
                <div id="alertsList" class="alerts-list"></div>
            </div>
        </div>
        <!-- 7. Comparison Panel -->
        <div class="section-title">7. Comparison Panel</div>
        <div class="dashboard-grid">
            <div class="card comparison-panel" style="grid-column: span 12;">
                <div class="card-header">
                    <div class="card-title">Comparison Panel</div>
                </div>
                <div class="filters" style="margin-bottom: 0;">
                    <div class="filter-item">
                        <label>Compare With</label>
                        <select id="comparisonType">
                            <option value="previous">Previous Movies</option>
                            <option value="genre">Genre</option>
                            <option value="actor">Actor</option>
                            <option value="panindia">Pan-India Avg</option>
                        </select>
                    </div>
                    <div class="filter-item" id="comparisonItemContainer">
                        <label id="comparisonItemLabel">Movie</label>
                        <select id="comparisonItem">
                            <option value="Movie A">Movie A</option>
                            <option value="Movie B">Movie B</option>
                            <option value="Movie C">Movie C</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container" style="height: 260px;">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>
        </div>
        <!-- 8. Drill-Down Feature -->
        <div class="section-title">8. Drill-Down Feature</div>
        <div class="dashboard-grid">
            <div class="card section-subtitle" style="grid-column: span 12;">
                Click on any city in <b>Top Cities</b> to see theatres, then on a theatre to see shows, then on a show to see seat category analysis.
            </div>
        </div>
    </div>

    <!-- Drill-down Modal -->
    <div id="drilldownModal" class="drilldown-modal" style="display:none;">
        <div class="drilldown-modal-content">
            <span class="drilldown-modal-close" id="drilldownModalClose">&times;</span>
            <div id="drilldownModalBody"></div>
        </div>
    </div>

    <script>
        window.onload = function() {
            // Day Wise Collection Chart
            const dayWiseCtx = document.getElementById('dayWiseChart').getContext('2d');
            new Chart(dayWiseCtx, {
                type: 'bar',
                data: {
                    labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5'],
                    datasets: [{
                        label: 'Collection (Cr)',
                        data: [1, 2, 4, 6, 6],
                        backgroundColor: '#FFD700',
                        borderColor: '#FFC000',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false,
                            labels: {
                                color: '#CCCCCC'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#333333'
                            },
                            ticks: {
                                color: '#CCCCCC'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#CCCCCC'
                            }
                        }
                    }
                }
            });

            // Cumulative Occupancy Trend Chart
            const occupancyTrendCtx = document.getElementById('occupancyTrendChart').getContext('2d');
            new Chart(occupancyTrendCtx, {
                type: 'line',
                data: {
                    labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5'],
                    datasets: [{
                        label: 'Occupancy (%)',
                        data: [30, 35, 38, 40, 42],
                        backgroundColor: 'rgba(0, 188, 212, 0.15)',
                        borderColor: '#00bcd4',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#00bcd4',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: '#333333' },
                            ticks: { color: '#CCCCCC', callback: v => v + '%' }
                        },
                        x: {
                            grid: { color: '#333333' },
                            ticks: { color: '#CCCCCC' }
                        }
                    }
                }
            });

            // Hourly Trend Chart
            const hourlyTrendCtx = document.getElementById('hourlyTrendChart').getContext('2d');
            new Chart(hourlyTrendCtx, {
                type: 'line',
                data: {
                    labels: ['1 PM', '4 PM', '6 PM', '8 PM'],
                    datasets: [{
                        label: 'Revenue',
                        data: [22, 46, 80, 68],
                        backgroundColor: 'rgba(255, 215, 0, 0.2)',
                        borderColor: '#FFD700',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#FFD700',
                        pointBorderColor: '#121212',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false,
                            labels: {
                                color: '#CCCCCC'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#333333'
                            },
                            ticks: {
                                color: '#CCCCCC'
                            }
                        },
                        x: {
                            grid: {
                                color: '#333333'
                            },
                            ticks: {
                                color: '#CCCCCC'
                            }
                        }
                    }
                }
            });

            // Revenue by City Chart
            const revenueByCityCtx = document.getElementById('revenueByCityChart').getContext('2d');
            new Chart(revenueByCityCtx, {
                type: 'bar',
                data: {
                    labels: ['Delhi', 'Hyderabad', 'Chennai', 'Mumbai', 'Kolkata'],
                    datasets: [{
                        label: 'Revenue (%)',
                        data: [60, 40, 20, 30, 15],
                        backgroundColor: [
                            '#00c6fb',
                            '#029cf5',
                            '#13e2c9',
                            '#1de9b6',
                            '#1dc8e9'
                        ],
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    indexAxis: 'y', // Horizontal bar
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { color: '#333333' },
                            ticks: { color: '#CCCCCC' }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { color: '#CCCCCC' }
                        }
                    }
                }
            });

            // Show-wise Revenue Breakdown Chart
            const showwiseBreakdownCtx = document.getElementById('showwiseBreakdownChart').getContext('2d');
            new Chart(showwiseBreakdownCtx, {
                type: 'bar',
                data: {
                    labels: ['Morning', 'Afternoon', 'Evening', 'Night'],
                    datasets: [{
                        label: 'Revenue (Lakh)',
                        data: [20, 35, 50, 30],
                        backgroundColor: [
                            '#FFD700',
                            '#FFC000',
                            '#FFA500',
                            '#00bcd4'
                        ],
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#333333' },
                            ticks: { color: '#CCCCCC' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#CCCCCC' }
                        }
                    }
                }
            });

            // Audience Drop-off After First Show Chart
            const audienceDropoffCtx = document.getElementById('audienceDropoffChart').getContext('2d');
            new Chart(audienceDropoffCtx, {
                type: 'line',
                data: {
                    labels: ['Show 1', 'Show 2', 'Show 3', 'Show 4'],
                    datasets: [{
                        label: 'Audience (%)',
                        data: [100, 70, 50, 40],
                        backgroundColor: 'rgba(255, 215, 0, 0.15)',
                        borderColor: '#FFD700',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#FFD700',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: '#333333' },
                            ticks: { color: '#CCCCCC', callback: v => v + '%' }
                        },
                        x: {
                            grid: { color: '#333333' },
                            ticks: { color: '#CCCCCC' }
                        }
                    }
                }
            });

            // Occupancy by Format Chart
            const occupancyByFormatCtx = document.getElementById('occupancyByFormatChart').getContext('2d');
            new Chart(occupancyByFormatCtx, {
                type: 'bar',
                data: {
                    labels: ['2D', '3D', 'IMAX'],
                    datasets: [{
                        label: 'Occupancy (%)',
                        data: [45, 60, 80],
                        backgroundColor: [
                            '#FFD700',
                            '#FFC000',
                            '#00bcd4'
                        ],
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: '#333333' },
                            ticks: { color: '#CCCCCC', callback: v => v + '%' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#CCCCCC' }
                        }
                    }
                }
            });

            // Chain-level Performance Chart
            const chainPerformanceCtx = document.getElementById('chainPerformanceChart').getContext('2d');
            new Chart(chainPerformanceCtx, {
                type: 'bar',
                data: {
                    labels: ['PVR', 'INOX', 'Miraj', 'Cinepolis'],
                    datasets: [{
                        label: 'Revenue (Lakh)',
                        data: [120, 90, 60, 80],
                        backgroundColor: [
                            '#FFD700',
                            '#FFC000',
                            '#FFA500',
                            '#00bcd4'
                        ],
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#333333' },
                            ticks: { color: '#CCCCCC' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#CCCCCC' }
                        }
                    }
                }
            });

            // Pricing Insights Circle Charts
            new Chart(document.getElementById('economyChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [68, 32],
                        backgroundColor: ['#FFD700', '#333333'],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: '70%',
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    responsive: false
                }
            });
            new Chart(document.getElementById('goldChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [36, 64],
                        backgroundColor: ['#FFC000', '#333333'],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: '70%',
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    responsive: false
                }
            });
            new Chart(document.getElementById('vipChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [60, 40],
                        backgroundColor: ['#FFA500', '#333333'],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: '70%',
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    responsive: false
                }
            });
        };

        // --- Interactive India Map (Geo Heatmap) ---
        // Demo city data: [city, lat, lng, value]
        const cityData = [
            { name: 'Delhi', lat: 28.6139, lng: 77.2090, value: 60 },
            { name: 'Mumbai', lat: 19.0760, lng: 72.8777, value: 30 },
            { name: 'Hyderabad', lat: 17.3850, lng: 78.4867, value: 40 },
            { name: 'Chennai', lat: 13.0827, lng: 80.2707, value: 20 },
            { name: 'Kolkata', lat: 22.5726, lng: 88.3639, value: 15 }
        ];
        // Only run if indiaMap div exists
        if (document.getElementById('indiaMap')) {
            const indiaBounds = [[6.5, 67], [37.1, 97.5]]; // SouthWest, NorthEast corners of India
            const map = L.map('indiaMap', {
                maxBounds: indiaBounds,
                maxBoundsViscosity: 1.0,
                minZoom: 4,
                maxZoom: 7
            }).setView([22.9734, 78.6569], 5);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                minZoom: 4,
                maxZoom: 7
            }).addTo(map);
            // Overlay India GeoJSON outline
            fetch('https://raw.githubusercontent.com/datameet/maps/master/States/india_states.geojson')
                .then(res => res.json())
                .then(geojson => {
                    L.geoJSON(geojson, {
                        style: {
                            color: '#00bcd4',
                            weight: 2,
                            fillOpacity: 0
                        }
                    }).addTo(map);
                });
            cityData.forEach(city => {
                const color = city.value >= 50 ? '#00bcd4' : city.value >= 30 ? '#FFC000' : '#FFA500';
                L.circleMarker([city.lat, city.lng], {
                    radius: 18 + city.value / 5,
                    fillColor: color,
                    color: '#222',
                    weight: 1,
                    fillOpacity: 0.7
                })
                .addTo(map)
                .bindTooltip(`<b>${city.name}</b><br>Value: ${city.value}%`, { direction: 'top' });
            });
        }

        // DataTables initialization for Theatre Table
        $(document).ready(function() {
            var table = $('#theatreTable').DataTable({
                dom: 'Bfrtip',
                buttons: [
                    {
                        extend: 'excelHtml5',
                        text: 'Export Excel',
                        className: 'btn btn-primary',
                        title: 'Theatre Data'
                    },
                    {
                        extend: 'pdfHtml5',
                        text: 'Export PDF',
                        className: 'btn btn-primary',
                        title: 'Theatre Data',
                        orientation: 'landscape',
                        pageSize: 'A4'
                    }
                ],
                paging: true,
                searching: true,
                ordering: true,
                info: true,
                responsive: true,
                language: {
                    search: "<span style='color:var(--accent-yellow)'>Search:</span>"
                }
            });
            // Custom Export button triggers DataTables export
            $('#exportExcelBtn').on('click', function() {
                table.button('.buttons-excel').trigger();
            });
        });

        // Alerts & Anomalies logic (based on theatre table demo data)
        const theatreAlertsData = [
            { name: 'Srex Cironas Prasads', occupancy: 78 },
            { name: 'Prasads Inerbit', occupancy: 65 },
            { name: 'Inerbit Mail Cinepolis', occupancy: 55 },
            { name: 'Cinepolis Orten Mail', occupancy: 60 },
            { name: 'Quixx Cinemas', occupancy: 48 },
            // Demo: add a cancelled and a high-performing show
            { name: 'Demo Cancelled Show', occupancy: 0 },
            { name: 'Demo High Performer', occupancy: 92 }
        ];
        function renderAlerts() {
            const alerts = [];
            theatreAlertsData.forEach(t => {
                if (t.occupancy === 0) {
                    alerts.push(`<div class='alert-item alert-cancel'><span class='alert-icon'>❌</span> Show cancelled or 0% occupancy at <b>${t.name}</b></div>`);
                } else if (t.occupancy < 50) {
                    alerts.push(`<div class='alert-item alert-low'><span class='alert-icon'>⚠️</span> Underperforming: <b>${t.name}</b> (Occupancy ${t.occupancy}%)</div>`);
                } else if (t.occupancy > 80) {
                    alerts.push(`<div class='alert-item alert-high'><span class='alert-icon'>✅</span> High-performing: <b>${t.name}</b> (Occupancy ${t.occupancy}%)</div>`);
                }
            });
            if (alerts.length === 0) {
                alerts.push(`<div class='alert-item'><span class='alert-icon'>ℹ️</span> No anomalies detected.</div>`);
            }
            document.getElementById('alertsList').innerHTML = alerts.join('');
        }
        renderAlerts();

        // Comparison Panel Demo Data
        const comparisonData = {
            previous: {
                label: 'Previous Movies',
                items: ['Movie A', 'Movie B', 'Movie C'],
                chart: {
                    labels: ['Current', 'Movie A', 'Movie B', 'Movie C'],
                    data: [120, 110, 90, 130]
                }
            },
            genre: {
                label: 'Genre',
                items: ['Action', 'Drama', 'Comedy'],
                chart: {
                    labels: ['Current', 'Action', 'Drama', 'Comedy'],
                    data: [120, 100, 80, 95]
                }
            },
            actor: {
                label: 'Actor',
                items: ['Actor X', 'Actor Y', 'Actor Z'],
                chart: {
                    labels: ['Current', 'Actor X', 'Actor Y', 'Actor Z'],
                    data: [120, 140, 110, 100]
                }
            },
            panindia: {
                label: 'Pan-India Avg',
                items: ['Day 1', 'Day 2', 'Day 3'],
                chart: {
                    labels: ['Current', 'Day 1', 'Day 2', 'Day 3'],
                    data: [120, 100, 90, 80]
                }
            }
        };
        let comparisonChart;
        function updateComparisonPanel(type = 'previous', item = null) {
            // Update label and items
            const label = comparisonData[type].label;
            document.getElementById('comparisonItemLabel').innerText = label;
            const itemSelect = document.getElementById('comparisonItem');
            itemSelect.innerHTML = comparisonData[type].items.map(i => `<option value="${i}">${i}</option>`).join('');
            // Update chart
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            if (comparisonChart) comparisonChart.destroy();
            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: comparisonData[type].chart.labels,
                    datasets: [{
                        label: 'Net Collection (Cr)',
                        data: comparisonData[type].chart.data,
                        backgroundColor: [
                            '#FFD700', '#FFC000', '#FFA500', '#00bcd4'
                        ],
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#333333' },
                            ticks: { color: '#CCCCCC' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#CCCCCC' }
                        }
                    }
                }
            });
        }
        document.getElementById('comparisonType').addEventListener('change', function() {
            updateComparisonPanel(this.value);
        });
        // Initial render
        updateComparisonPanel();

        // --- Drill-down Feature Logic ---
        // Demo data for drill-down
        const cityTheatres = {
            'Delhi': [
                { name: 'Cinepolis Orten Mail', chain: 'Cinepolis' },
                { name: 'Quixx Cinemas', chain: 'Quixx' }
            ],
            'Mumbai': [
                { name: 'INOX R-City', chain: 'INOX' },
                { name: 'PVR Phoenix', chain: 'PVR' }
            ],
            'Hyderabad': [
                { name: 'Srex Cironas Prasads', chain: 'Prasads' },
                { name: 'Prasads Inerbit', chain: 'Prasads' },
                { name: 'Inerbit Mail Cinepolis', chain: 'Cinepolis' }
            ],
            'Chennai': [
                { name: 'Sathyam Cinemas', chain: 'SPI' } ],
            'Kolkata': [
                { name: 'Navina Cinema', chain: 'Navina' } ]
        };
        const theatreShows = {
            'Cinepolis Orten Mail': [
                { show: '5:45 PM', occupancy: 60, collection: '3.2 Cr' },
                { show: '8:00 PM', occupancy: 80, collection: '4.1 Cr' }
            ],
            'Quixx Cinemas': [
                { show: '4:28 PM', occupancy: 48, collection: '3.0 Cr' } ],
            'INOX R-City': [
                { show: '6:00 PM', occupancy: 70, collection: '2.8 Cr' } ],
            'PVR Phoenix': [
                { show: '9:00 PM', occupancy: 90, collection: '5.0 Cr' } ],
            'Srex Cironas Prasads': [
                { show: '6 PM', occupancy: 78, collection: '12.5 Cr' } ],
            'Prasads Inerbit': [
                { show: '4 PM', occupancy: 65, collection: '4.0 Cr' } ],
            'Inerbit Mail Cinepolis': [
                { show: '7 PM', occupancy: 55, collection: '4.2 Cr' } ],
            'Sathyam Cinemas': [
                { show: '7:30 PM', occupancy: 75, collection: '2.2 Cr' } ],
            'Navina Cinema': [
                { show: '5:00 PM', occupancy: 60, collection: '1.8 Cr' } ]
        };
        const showSeatCategory = {
            'Cinepolis Orten Mail|5:45 PM': { Economy: 60, Gold: 25, VIP: 15 },
            'Cinepolis Orten Mail|8:00 PM': { Economy: 50, Gold: 30, VIP: 20 },
            'Quixx Cinemas|4:28 PM': { Economy: 70, Gold: 20, VIP: 10 },
            'INOX R-City|6:00 PM': { Economy: 55, Gold: 30, VIP: 15 },
            'PVR Phoenix|9:00 PM': { Economy: 40, Gold: 35, VIP: 25 },
            'Srex Cironas Prasads|6 PM': { Economy: 68, Gold: 20, VIP: 12 },
            'Prasads Inerbit|4 PM': { Economy: 60, Gold: 25, VIP: 15 },
            'Inerbit Mail Cinepolis|7 PM': { Economy: 65, Gold: 20, VIP: 15 },
            'Sathyam Cinemas|7:30 PM': { Economy: 70, Gold: 20, VIP: 10 },
            'Navina Cinema|5:00 PM': { Economy: 60, Gold: 30, VIP: 10 }
        };
        // Modal logic
        function openDrilldownModal(html) {
            document.getElementById('drilldownModalBody').innerHTML = html;
            document.getElementById('drilldownModal').style.display = 'flex';
        }
        function closeDrilldownModal() {
            document.getElementById('drilldownModal').style.display = 'none';
            document.getElementById('drilldownModalBody').innerHTML = '';
        }
        document.getElementById('drilldownModalClose').onclick = closeDrilldownModal;
        window.onclick = function(event) {
            if (event.target === document.getElementById('drilldownModal')) closeDrilldownModal();
        };
        // City click
        document.querySelectorAll('.city-link').forEach(el => {
            el.onclick = function() {
                const city = this.getAttribute('data-city');
                const theatres = cityTheatres[city] || [];
                let html = `<h2>Theatres in ${city}</h2><table><thead><tr><th>Theatre</th><th>Chain</th></tr></thead><tbody>`;
                theatres.forEach(t => {
                    html += `<tr><td><span class='theatre-link' data-theatre='${t.name}'>${t.name}</span></td><td>${t.chain}</td></tr>`;
                });
                html += '</tbody></table>';
                openDrilldownModal(html);
                // Theatre click
                document.querySelectorAll('.theatre-link').forEach(tel => {
                    tel.onclick = function() {
                        const theatre = this.getAttribute('data-theatre');
                        const shows = theatreShows[theatre] || [];
                        let html2 = `<h2>Shows at ${theatre}</h2><table><thead><tr><th>Show Time</th><th>Occupancy %</th><th>Net Collection</th></tr></thead><tbody>`;
                        shows.forEach(s => {
                            html2 += `<tr><td><span class='show-link' data-theatre='${theatre}' data-show='${s.show}'>${s.show}</span></td><td>${s.occupancy}%</td><td>${s.collection}</td></tr>`;
                        });
                        html2 += '</tbody></table>';
                        openDrilldownModal(html2);
                        // Show click
                        document.querySelectorAll('.show-link').forEach(sel => {
                            sel.onclick = function() {
                                const theatre = this.getAttribute('data-theatre');
                                const show = this.getAttribute('data-show');
                                const key = `${theatre}|${show}`;
                                const cat = showSeatCategory[key];
                                let html3 = `<h2>Seat Category Analysis<br><span style='font-size:15px;color:var(--accent-yellow)'>${theatre} - ${show}</span></h2><div class='seat-pie-container'><canvas id='seatPieChart'></canvas></div>`;
                                openDrilldownModal(html3);
                                // Draw pie chart
                                setTimeout(() => {
                                    new Chart(document.getElementById('seatPieChart').getContext('2d'), {
                                        type: 'doughnut',
                                        data: {
                                            labels: ['Economy', 'Gold', 'VIP'],
                                            datasets: [{
                                                data: [cat.Economy, cat.Gold, cat.VIP],
                                                backgroundColor: ['#FFD700', '#FFC000', '#FFA500'],
                                                borderWidth: 0
                                            }]
                                        },
                                        options: {
                                            cutout: '70%',
                                            plugins: { legend: { display: true, labels: { color: '#fff' } } },
                                            responsive: false
                                        }
                                    });
                                }, 100);
                            };
                        });
                    };
                });
            };
        });
    </script>
</body>
</html>